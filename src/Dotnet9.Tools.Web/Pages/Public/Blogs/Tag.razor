@page "/tag/{name?}"
@using Dotnet9.Tools.Web.Models
@using Dotnet9.Tools.Web.Shared.Public
@using System.Net
@layout DocLayout

<h1 class="entry-title">标签云 @(string.IsNullOrWhiteSpace(Name) ? "" : $":{Name}")</h1>

@if (string.IsNullOrWhiteSpace(Name))
{
    <PageTitle>标签云 - D9工具箱</PageTitle>

    var random = new Random(DateTime.Now.Millisecond);
    @foreach (var tag in ConstData.BlogTagItems)
    {
        <MButton Class="ma-1 text-capitalize" Outlined Color="@ConstData.RandomColor" Rounded Href="@($"/tag/{WebUtility.UrlEncode(tag)}")">
            @tag
        </MButton>
    }
}
else if (_items is {Count: > 0 })
{
    <CardItemList Items="_items"></CardItemList>
}
else
{
    <NotFound/>
}

@code {

    [Parameter]
    public string? Name { get; set; }

    List<CardItem>? _items;

    protected override async Task OnParametersSetAsync()
    {
        _items?.Clear();
        if (string.IsNullOrWhiteSpace(Name))
        {
            await Task.CompletedTask;
            return;
        }

        var factName = WebUtility.UrlDecode(Name);
        var posts = ConstData.BlogPostItems!.FindAll(x => x.Tags != null && x.Tags.Contains(factName));
        if (posts.Count <= 0)
        {
            return;
        }
        _items = posts.Select(x =>
        {
            var category = ConstData.CategoryNotTreeItems.FirstOrDefault(c => c.Name == x.Categories![0]);
            return CardItemExtension.CreateCardItem(category, x);
        }).ToList();
    }

}

<style>
    .entry-title { text-align: left; }
</style>