@using BlazorComponent
@using System.Globalization
@using BlazorComponent.I18n
<span @onclick=@(() =>{ Navigation.NavigateTo("/"); SelectTab = 0;})>
    <img style="cursor: pointer; height: 64px; width: 64px;" class="ml-6" src="/logo.png"/>
</span>
<MTabs BackgroundColor="white" Class="mtab-font" Style="margin-left: 120px;" Color="black" SliderColor="purple darken-2" Optional @bind-Value="SelectTab">
    <MTab Style="text-transform: none" Href="/">@T("Home")</MTab>
    <MTab Style="text-transform: none" Href="/tools">@T("Tools")</MTab>
    <MTab Style="text-transform: none" Href="/album">@T("Album")</MTab>
    <MTab Style="text-transform: none" Href="/cat">@T("Blog")</MTab>
    <MTab Style="text-transform: none" Href="/tag">@T("Tag")</MTab>
    <MTab Style="text-transform: none" Href="/timelines">@T("Timelines")</MTab>
    <MTab Style="text-transform: none" Href="/about">@T("About")</MTab>
</MTabs>

<MSpacer></MSpacer>

<Search/>

<MButton Icon Href="https://github.com/dotnet9/dotnet9.com" Target="_blank">
    <MIcon Size="24" Color="black">fab fa-github</MIcon>
</MButton>
<MButton Icon Href="https://gitee.com/dotnet9/dotnet9.com" Target="_blank">
    <img style="height: 24px; width: 24px;" src="https://img1.dotnet9.com/2022/01/gitee.png" alt="Gitee">
</MButton>
<MButton Icon OnClick="TurnLanguage" Class="mr-6">
    <img src="@_languageIcon" alt=""/>
</MButton>

@code{

    [Parameter]
    public bool IsChinese { get; set; }

    [Inject]
    public NavigationManager Navigation { get; set; } = default!;

    [Inject]
    public I18nConfig I18nConfig { get; set; } = default!;

    [CascadingParameter]
    public PublicLayout MainLayout { get; set; } = default!;

    private string? _languageIcon;
    public StringNumber SelectTab { get; set; } = 0;


    protected override async Task OnInitializedAsync()
    {
        var lang = I18nConfig.Language ?? CultureInfo.CurrentCulture.Name;

        IsChinese = lang == "zh-CN";

        await ChangeLanguage(lang);
    }


    private async Task TurnLanguage()
    {
        IsChinese = !IsChinese;
        var lang = IsChinese ? "zh-CN" : "en-US";

        await ChangeLanguage(lang);

        I18nConfig.Language = lang;
    }

    private async Task ChangeLanguage(string lang)
    {
        _languageIcon = $"{lang}.png";
        await MainLayout.ChangeLanguage(lang);

        await Task.CompletedTask;
    }

    public string T(string key)
    {
        return MainLayout.T(key);
    }

}