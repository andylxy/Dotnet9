@using Dotnet9.Tools.Web.Utils
<MTextField TValue="string"
            @bind-value="@_search"
            HideDetails="true"
            Class="@("mx-2 mx-md-4")"
            Style="@($"width: 300px; opacity: 0.8; border: 1px solid {_searchBorderColor};")"
            @onfocus="@(() => _searchBorderColor = "#C9CDD4")"
            @onblur="@(() => _searchBorderColor = "#00000000")"
            OnKeyDown="ExecuteSearch"
            ClearIcon="mdi-close-circle"
            Clearable
            OnClearClick="ClearSearch"
            Flat
            Solo
            Dense
            BackgroundColor="#F2F3F5"
            Color="grey lighten-1"
            Placeholder="@T("Search")">
    <PrependInnerContent>
        <MIcon Color="grey lighten-1">mdi-magnify</MIcon>
    </PrependInnerContent>
</MTextField>

@code {

    [Inject]
    public NavigationManager Navigation { get; set; } = default!;

    [CascadingParameter]
    public PublicLayout MainLayout { get; set; } = default!;

    private string? _search;
    private string _searchBorderColor = "#00000000";

    private async Task ClearSearch()
    {
        _search = string.Empty;
        await Task.CompletedTask;
    }

    private void ExecuteSearch(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && !string.IsNullOrWhiteSpace(_search))
        {
            Navigation.NavigateTo(_search.GetQueryUrl());
        }
    }

    public string? T(string key)
    {
        return MainLayout.T(key);
    }

}